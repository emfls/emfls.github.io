<!DOCTYPE html>
<html lang="ko">
<head>
    <title>자동 사이트맵 생성기</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>사이트맵 생성 중...</h1>
    <div id="result"></div>
    
    <script>
    // 여기에 여러분의 GitHub 정보를 입력하세요
    const GITHUB_USERNAME = 'emfls';
    const REPO_NAME = 'kor';  // 실제 저장소 이름으로 수정하세요
    const FOLDER_PATH = 'report/camp';  // 폴더 경로는 별도로 지정
    const BASE_URL = `https://${GITHUB_USERNAME}.github.io/${REPO_NAME}`;
    
    async function generateSitemap() {
        try {
            // 폴더 경로가 있으면 포함해서 API 호출
            const apiUrl = FOLDER_PATH 
                ? `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FOLDER_PATH}`
                : `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents`;
                
            console.log('API URL:', apiUrl);  // 디버깅용
            
            const response = await fetch(apiUrl);
            const data = await response.json();
            
            console.log('API 응답:', data);  // 디버깅용
            
            // API 오류 체크
            if (!response.ok) {
                throw new Error(`GitHub API 오류: ${data.message || response.statusText}`);
            }
            
            // 배열인지 확인
            if (!Array.isArray(data)) {
                throw new Error('응답이 배열이 아닙니다. 저장소나 폴더 경로를 확인해주세요.');
            }
            
            let sitemap = '<?xml version="1.0" encoding="UTF-8"?>\n';
            sitemap += '<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n';
            
            const today = new Date().toISOString().split('T')[0];
            let htmlFileCount = 0;
            
            // HTML 파일들만 찾아서 사이트맵에 추가
            data.forEach(file => {
                if (file.name.endsWith('.html') || file.name.endsWith('.htm')) {
                    const fileUrl = FOLDER_PATH 
                        ? `${BASE_URL}/${FOLDER_PATH}/${file.name}`
                        : `${BASE_URL}/${file.name}`;
                        
                    sitemap += `  <url>\n`;
                    sitemap += `    <loc>${fileUrl}</loc>\n`;
                    sitemap += `    <lastmod>${today}</lastmod>\n`;
                    sitemap += `    <changefreq>weekly</changefreq>\n`;
                    sitemap += `    <priority>0.8</priority>\n`;
                    sitemap += `  </url>\n`;
                    htmlFileCount++;
                }
            });
            
            sitemap += '</urlset>';
            
            // 결과 표시
            if (htmlFileCount === 0) {
                document.getElementById('result').innerHTML = 
                    '<p style="color: orange;">HTML 파일을 찾을 수 없습니다.</p>' +
                    '<p>찾은 파일들:</p>' +
                    '<ul>' + data.map(file => `<li>${file.name} (${file.type})</li>`).join('') + '</ul>';
            } else {
                document.getElementById('result').innerHTML = 
                    `<h2>생성된 사이트맵 (${htmlFileCount}개 파일):</h2>` +
                    '<textarea rows="20" cols="80">' + sitemap + '</textarea>' +
                    '<br><br><button onclick="downloadSitemap()">sitemap.xml 다운로드</button>';
                
                window.generatedSitemap = sitemap;
            }
            
        } catch (error) {
            console.error('오류 상세:', error);
            document.getElementById('result').innerHTML = 
                '<p style="color: red;">오류: ' + error.message + '</p>' +
                '<p><strong>확인사항:</strong></p>' +
                '<ul>' +
                '<li>GitHub 사용자명: ' + GITHUB_USERNAME + '</li>' +
                '<li>저장소명: ' + REPO_NAME + '</li>' +
                '<li>폴더 경로: ' + (FOLDER_PATH || '루트') + '</li>' +
                '<li>저장소가 공개(public)인지 확인</li>' +
                '</ul>';
        }
    }
    
    function downloadSitemap() {
        const blob = new Blob([window.generatedSitemap], { type: 'text/xml' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'sitemap.xml';
        a.click();
        URL.revokeObjectURL(url);
    }
    
    // 페이지 로드 시 자동 실행
    generateSitemap();
    </script>
</body>
</html>
