<!doctype html>
<html lang="ru">
    <head>
        <meta charset="UTF-8" />
        <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏ –°–∫–∞–Ω–µ—Ä QR-–∫–æ–¥–æ–≤ ‚Äì –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –û–Ω–ª–∞–π–Ω –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</title>
        <meta name="viewport" content="width=device-width,initial-scale=1.0" />
        <meta
            name="description"
            content="–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏ —Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ. –í—Å—ë –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤. –°–∫–∞—á–∏–≤–∞–π—Ç–µ, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ –∏ —á–∏—Ç–∞–π—Ç–µ QR-–∫–æ–¥—ã —Å –ª—ë–≥–∫–æ—Å—Ç—å—é." />
        <meta
            name="keywords"
            content="QR-–∫–æ–¥, –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä QR, –°–∫–∞–Ω–µ—Ä QR, QR –û–Ω–ª–∞–π–Ω, –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π QR –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –ß–∏—Ç–∞—Ç–µ–ª—å QR, QR —Å –≤–µ–±-–∫–∞–º–µ—Ä–æ–π, QR –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏, –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å" />
        <meta name="author" content="Itagi" />
        <meta name="language" content="ru" />
        <link rel="canonical" href="https://emfls.github.io/ru/util/qrcode/" />
        <link rel="icon" href="https://emfls.github.io/icon-192.png" />
        <meta property="og:title" content="–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏ –°–∫–∞–Ω–µ—Ä QR-–∫–æ–¥–æ–≤ ‚Äì –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –û–Ω–ª–∞–π–Ω –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç" />
        <meta
            property="og:description"
            content="–°–æ–∑–¥–∞–≤–∞–π—Ç–µ QR-–∫–æ–¥—ã –¥–ª—è —Ç–µ–∫—Å—Ç–∞, URL –∏–ª–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏ —Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR —Å –∫–∞–º–µ—Ä—ã –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –í—Å—ë –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö." />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://emfls.github.io/ru/util/qrcode/" />
        <meta property="og:image" content="https://emfls.github.io/thumbnail.png" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content="–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏ –°–∫–∞–Ω–µ—Ä QR-–∫–æ–¥–æ–≤ ‚Äì –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –û–Ω–ª–∞–π–Ω –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç" />
        <meta
            name="twitter:description"
            content="–ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∏ —Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –ü–æ–ª–Ω–∞—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ." />
        <meta name="twitter:image" content="https://emfls.github.io/thumbnail.png" />

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-QP5Q67GE5B"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag("js", new Date());
            gtag("config", "G-QP5Q67GE5B");
        </script>
        <script
            async
            src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8830524482034754"
            crossorigin="anonymous"></script>

        <!-- qrcode.js (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è) -->
        <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
        <!-- html5-qrcode (—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ) -->
        <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>

        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <div class="container">
            <div class="logo">üî≥ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR</div>
            <div class="desc">
                –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥—ã –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ —Å—Å—ã–ª–æ–∫,<br />
                –∏ —Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ –∏—Ö —Å –∫–∞–º–µ—Ä—ã –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.<br />
                <span style="color: #199aac; font-size: 0.97em">–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</span>
            </div>
            <div class="tab-toggle">
                <button class="tab-btn active" id="genTab">–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="tab-btn" id="readTab">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ -->
            <div class="section active" id="genSection">
                <span class="label">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ —Å—Å—ã–ª–∫—É:</span>
                <textarea id="qrInput" class="input-area" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ URL..."></textarea>
                <div class="qr-options">
                    <label>
                        –†–∞–∑–º–µ—Ä
                        <select id="qrSize">
                            <option value="160">160√ó160</option>
                            <option value="240" selected>240√ó240</option>
                            <option value="320">320√ó320</option>
                            <option value="400">400√ó400</option>
                        </select>
                    </label>
                    <label>
                        –£—Ä–æ–≤–µ–Ω—å –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏
                        <select id="qrLevel">
                            <option value="L">L (7%)</option>
                            <option value="M" selected>M (15%)</option>
                            <option value="Q">Q (25%)</option>
                            <option value="H">H (30%)</option>
                        </select>
                    </label>
                </div>
                <button class="qr-btn" id="qrGenBtn">–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å QR</button>
                <div id="qrCode"></div>
                <a id="qrDownload" class="qr-download" style="display: none" download="qrcode.png">–°–∫–∞—á–∞—Ç—å PNG</a>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
            <div class="section" id="readSection">
                <div class="qr-options">
                    <button class="qr-btn" id="startCamBtn">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å –∫–∞–º–µ—Ä—ã</button>
                    <button class="qr-btn" id="stopCamBtn" style="display: none">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
                </div>
                <div id="reader" style="width: 100%; max-width: 370px; margin: auto; display: none"></div>
                <div class="or">–∏–ª–∏</div>
                <input type="file" id="imgUpload" accept="image/*" style="display: block; margin: auto" />
                <div id="scanResult" class="output-box"></div>
            </div>
            <div class="footer">
                –ë–µ–∑ –∑–∞–≥—Ä—É–∑–æ–∫ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è, –≤—Å—ë –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.<br />
                –ò—Å–ø–æ–ª—å–∑—É–µ—Ç <a href="https://github.com/davidshimjs/qrcodejs" target="_blank" style="color: #1664a7">QRCode.js</a> –∏ <a href="https://github.com/mebjas/html5-qrcode" target="_blank" style="color: #1664a7">html5-qrcode</a>.
            </div>
            <a href="../" id="backBtn">–î—Ä—É–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</a>
        </div>
        <script>
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
            const genTab = document.getElementById("genTab");
            const readTab = document.getElementById("readTab");
            const genSection = document.getElementById("genSection");
            const readSection = document.getElementById("readSection");
            genTab.onclick = () => {
                genTab.classList.add("active");
                readTab.classList.remove("active");
                genSection.classList.add("active");
                readSection.classList.remove("active");
            };
            readTab.onclick = () => {
                readTab.classList.add("active");
                genTab.classList.remove("active");
                readSection.classList.add("active");
                genSection.classList.remove("active");
            };

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR
            let qrObj = null;
            function updateQR() {
                const text = document.getElementById("qrInput").value.trim();
                const size = parseInt(document.getElementById("qrSize").value, 10);
                const level = document.getElementById("qrLevel").value;
                const qrCodeDiv = document.getElementById("qrCode");
                qrCodeDiv.innerHTML = "";
                if (!text) return;
                qrObj = new QRCode(qrCodeDiv, {
                    text: text,
                    width: size,
                    height: size,
                    correctLevel: QRCode.CorrectLevel[level]
                });
                setTimeout(() => {
                    const canvas = qrCodeDiv.querySelector("canvas");
                    if (canvas) {
                        const url = canvas.toDataURL();
                        const dl = document.getElementById("qrDownload");
                        dl.href = url;
                        dl.download = "qrcode.png";
                        dl.style.display = "";
                    }
                }, 300);
            }
            document.getElementById("qrGenBtn").onclick = updateQR;
            document.getElementById("qrInput").addEventListener("keyup", (e) => {
                if (e.key === "Enter" && !e.shiftKey) updateQR();
            });
            document.getElementById("qrSize").onchange = updateQR;
            document.getElementById("qrLevel").onchange = updateQR;

            // –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR
            let html5Qr = null;
            const readerDiv = document.getElementById("reader");
            const startCamBtn = document.getElementById("startCamBtn");
            const stopCamBtn = document.getElementById("stopCamBtn");
            const scanResult = document.getElementById("scanResult");
            let camActive = false;
            startCamBtn.onclick = () => {
                readerDiv.style.display = "";
                scanResult.textContent = "";
                startCamBtn.style.display = "none";
                stopCamBtn.style.display = "";
                html5Qr = new Html5Qrcode("reader");
                html5Qr.start(
                    { facingMode: "environment" },
                    { fps: 10, qrbox: 240 },
                    (code) => {
                        scanResult.innerHTML = `<b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b> ${escapeHtml(code)}`;
                        html5Qr.stop();
                        camActive = false;
                        startCamBtn.style.display = "";
                        stopCamBtn.style.display = "none";
                    },
                    (err) => {}
                );
                camActive = true;
            };
            stopCamBtn.onclick = () => {
                if (html5Qr && camActive) {
                    html5Qr.stop().then(() => {
                        readerDiv.style.display = "none";
                        startCamBtn.style.display = "";
                        stopCamBtn.style.display = "none";
                    });
                }
            };
            window.addEventListener("beforeunload", () => {
                if (html5Qr && camActive) html5Qr.stop();
            });

            // –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            document.getElementById("imgUpload").onchange = function (e) {
                const file = e.target.files[0];
                if (!file) return;
                scanResult.textContent = "–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...";
                Html5Qrcode.scanFile(file, true)
                    .then((code) => {
                        scanResult.innerHTML = `<b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b> ${escapeHtml(code)}`;
                    })
                    .catch(() => {
                        scanResult.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å QR-–∫–æ–¥ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏.";
                    });
            };

            function escapeHtml(text) {
                if (!text) return "";
                return text.replace(/[&<>"']/g, (ch) => ({
                    "&": "&amp;",
                    "<": "&lt;",
                    ">": "&gt;",
                    '"': "&quot;",
                    "'": "&#039;"
                })[ch]);
            }
        </script>
    </body>
</html>
