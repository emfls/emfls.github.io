<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–∂–∞—Ç–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚Äì –£–º–µ–Ω—å—à–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –≤–∞—à–∏—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="title" content="–ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ —Å–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚Äì –ú–∞—Å—Å–æ–≤–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –æ–Ω–ª–∞–π–Ω" />
  <meta
    name="description"
    content="–°–∂–∏–º–∞–π—Ç–µ –∏ —É–º–µ–Ω—å—à–∞–π—Ç–µ —Ä–∞–∑–º–µ—Ä –≤–∞—à–∏—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ü–∞–∫–µ—Ç–Ω–æ–µ —Å–∂–∞—Ç–∏–µ, 100% –±–µ—Å–ø–ª–∞—Ç–Ω–æ –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å. –ë–µ–∑ –∑–∞–≥—Ä—É–∑–æ–∫, –±–µ–∑ –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤, –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ." />
  <link rel="canonical" href="https://emfls.github.io/ru/util/ImageCompressor" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://emfls.github.io/ru/util/ImageCompressor/" />
  <meta property="og:title" content="–ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ —Å–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚Äì –ú–∞—Å—Å–æ–≤–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –æ–Ω–ª–∞–π–Ω" />
  <meta
    property="og:description"
    content="–°–∂–∏–º–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ —ç–∫–æ–Ω–æ–º—å—Ç–µ –º–µ—Å—Ç–æ. –í—Å—ë –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –±–µ–∑ –∑–∞–≥—Ä—É–∑–æ–∫ –∏ –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤." />
  <meta property="og:image" content="https://emfls.github.io/thumbnail.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:url" content="https://emfls.github.io/ru/util/ImageCompressor/" />
  <meta name="twitter:title" content="–ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ —Å–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚Äì –ú–∞—Å—Å–æ–≤–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –æ–Ω–ª–∞–π–Ω" />
  <meta
    name="twitter:description"
    content="–°–∂–∏–º–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞. 100% –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å." />
  <meta name="twitter:image" content="https://emfls.github.io/thumbnail.png" />
  <meta
    name="keywords"
    content="—Å–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π, –ø–∞–∫–µ—Ç–Ω–æ–µ —Å–∂–∞—Ç–∏–µ, –æ–Ω–ª–∞–π–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, —É–º–µ–Ω—å—à–µ–Ω–∏–µ jpg, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π, –±–µ—Å–ø–ª–∞—Ç–Ω–æ, –±–µ–∑ –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤" />
  <meta name="language" content="ru" />
  <meta name="author" content="Itagi" />
  <link rel="icon" href="https://emfls.github.io/icon-192.png" />
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QP5Q67GE5B"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag("js", new Date());
    gtag("config", "G-QP5Q67GE5B");
  </script>
  <!-- Google AdSense -->
  <script
    async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8830524482034754"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <div class="logo"><span class="logo-icon">ü™Ñ</span>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–∂–∞—Ç–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</div>
    <h2>–ú–∞—Å—Å–æ–≤–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</h2>
    <div class="desc">
      –°–∂–∏–º–∞–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —É–º–µ–Ω—å—à–∞–π—Ç–µ –∏—Ö —Ä–∞–∑–º–µ—Ä –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ.<br />
      100% –±–µ—Å–ø–ª–∞—Ç–Ω–æ –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å. –ë–µ–∑ –∑–∞–≥—Ä—É–∑–æ–∫.<br />
      <span style="font-size: 0.92em; color: #1ca5b0">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤!</span>
    </div>
    <input type="file" id="fileInput" accept="image/*" multiple />
    <div class="slider-wrap" id="sliderWrap" style="display: none">
      <label for="qualityRange">–ö–∞—á–µ—Å—Ç–≤–æ —Å–∂–∞—Ç–∏—è: <span id="qualityVal">80</span>%</label>
      <input type="range" id="qualityRange" min="10" max="100" value="80" />
    </div>
    <div id="gallery" class="gallery"></div>
    <button class="all-download-btn" id="allDownloadBtn" style="display: none">–°–∫–∞—á–∞—Ç—å –≤—Å—ë –≤ ZIP</button>
    <section id="faq" aria-labelledby="faq-head">
      <h3 id="faq-head">–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã ‚Äì –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</h3>
      <dl>
        <dt>–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ª–∏ –º–æ–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–∞ –∫–∞–∫–æ–π-–ª–∏–±–æ —Å–µ—Ä–≤–µ—Ä?</dt>
        <dd>–ù–µ—Ç. –í—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ª–æ–∫–∞–ª—å–Ω–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ; –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ –∫–∞–∫–æ–π-–ª–∏–±–æ —Å–µ—Ä–≤–µ—Ä.</dd>
        <dt>–ö–∞–∫–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è?</dt>
        <dd>–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å JPG, PNG, WebP –∏ —Ç.–¥. –í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JPEG –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Å–∂–∞—Ç–∏—è.</dd>
        <dt>–ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π?</dt>
        <dd>–í –¥–∏–∞–ª–æ–≥–µ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Ctrl –∏–ª–∏ Shift (–∏–ª–∏ –¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º) –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.</dd>
        <dt>–°–∫–æ–ª—å–∫–æ –º–µ—Å—Ç–∞ –º–æ–∂–Ω–æ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å?</dt>
        <dd>–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫, –æ–±—ã—á–Ω–æ —Ä–∞–∑–º–µ—Ä —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –Ω–∞ 50-90%.</dd>
        <dt>–ï—Å—Ç—å –ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —Ä–∞–∑–º–µ—Ä—É –∏–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É?</dt>
        <dd>–°—Ç—Ä–æ–≥–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–µ—Ç, –Ω–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –º–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 20-30 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π).</dd>
        <dt>–ï—Å—Ç—å –ª–∏ –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏ –∏–ª–∏ –ø–ª–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏?</dt>
        <dd>–ù–µ—Ç. –ë–µ–∑ –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤, –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ—Å–ø–ª–∞—Ç–Ω–æ.</dd>
      </dl>
    </section>
  </div>
  <a href="../" id="backBtn">–î—Ä—É–≥–∏–µ —É—Ç–∏–ª–∏—Ç—ã</a>
  <!-- JSZip –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ ZIP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script>
    const fileInput = document.getElementById("fileInput");
    const qualityRange = document.getElementById("qualityRange");
    const qualityVal = document.getElementById("qualityVal");
    const sliderWrap = document.getElementById("sliderWrap");
    const gallery = document.getElementById("gallery");
    const allDownloadBtn = document.getElementById("allDownloadBtn");
    let filesData = [], compressQuality = 0.8;
    function updateQualityVal() {
      qualityVal.textContent = qualityRange.value;
      compressQuality = qualityRange.value / 100;
    }
    updateQualityVal();
    qualityRange.addEventListener("input", async () => {
      updateQualityVal();
      if (filesData.length) await processAllFiles(filesData.map(f => f.file));
    });
    fileInput.addEventListener("change", async () => {
      const files = Array.from(fileInput.files);
      if (!files.length) return;
      await processAllFiles(files);
    });
    async function processAllFiles(files) {
      gallery.innerHTML = "";
      filesData = [];
      sliderWrap.style.display = "block";
      allDownloadBtn.style.display = "none";
      for (const file of files) {
        const card = document.createElement("div");
        card.className = "img-card";
        const originalImg = document.createElement("img");
        originalImg.className = "img-preview";
        const compressedImg = document.createElement("img");
        compressedImg.className = "img-preview";
        compressedImg.style.border = "1.5px solid #13d2b0";
        const reader = new FileReader();
        await new Promise(res => {
          reader.onload = e => {
            originalImg.src = e.target.result;
            res();
          };
          reader.readAsDataURL(file);
        });
        const { compressedDataUrl, compressedSize, width, height } = await compressImage(file, compressQuality);
        compressedImg.src = compressedDataUrl;
        const infoDiv = document.createElement("div"); infoDiv.className = "img-info";
        const nameDiv = document.createElement("div"); nameDiv.className = "img-name";
        nameDiv.textContent = file.name.length > 32 ? file.name.slice(0,30)+"‚Ä¶" : file.name;
        const sizesDiv = document.createElement("div"); sizesDiv.className = "img-sizes";
        const origKB = (file.size/1024).toFixed(1), compKB = (compressedSize/1024).toFixed(1);
        const redPct = Math.max(0,100-(compressedSize/file.size)*100).toFixed(1);
        sizesDiv.innerHTML = `–û—Ä–∏–≥–∏–Ω–∞–ª: ${origKB} –ö–ë ‚Üí –°–∂–∞—Ç—ã–π: <b>${compKB} –ö–ë</b><br>
          <span style="color:#16b980">${redPct}% —É–º–µ–Ω—å—à–µ–Ω–æ</span><br>
          <span style="font-size:0.89em;color:#229;">${width}√ó${height}px</span>`;
        const actionsDiv = document.createElement("div"); actionsDiv.className = "img-actions";
        const dlBtn = document.createElement("button"); dlBtn.className = "download-btn"; dlBtn.textContent = "–°–∫–∞—á–∞—Ç—å";
        const autoName = file.name.replace(/\.[^/.]+$/, "") + "_compressed.jpg";
        dlBtn.onclick = ()=>downloadSingle(compressedDataUrl, autoName);
        actionsDiv.appendChild(dlBtn);
        card.appendChild(originalImg);
        card.appendChild(compressedImg);
        infoDiv.appendChild(nameDiv);
        infoDiv.appendChild(sizesDiv);
        infoDiv.appendChild(actionsDiv);
        card.appendChild(infoDiv);
        gallery.appendChild(card);
        filesData.push({ file, compressedDataUrl, compressedSize, fileName: autoName });
      }
      if (filesData.length>1) allDownloadBtn.style.display="block";
    }
    async function compressImage(file, quality=0.8){
      const img=new Image(); img.src=URL.createObjectURL(file); await img.decode();
      let [w,h]=[img.width,img.height], max=1600;
      if(w>max||h>max){ const r=Math.min(max/w,max/h); w=Math.round(w*r); h=Math.round(h*r); }
      const canvas=document.createElement("canvas"); canvas.width=w; canvas.height=h;
      canvas.getContext("2d").drawImage(img,0,0,w,h);
      const dataUrl=canvas.toDataURL("image/jpeg",quality);
      const len=(dataUrl.length*3)/4;
      return { compressedDataUrl:dataUrl, compressedSize:len, width:w, height:h };
    }
    function downloadSingle(dataUrl,name){
      const a=document.createElement("a"); a.href=dataUrl; a.download=name; a.click();
    }
    allDownloadBtn.onclick=async()=>{
      if(!filesData.length) return;
      const zip=new JSZip();
      filesData.forEach(({compressedDataUrl,fileName})=>{
        const blob=dataURItoBlob(compressedDataUrl);
        zip.file(fileName,blob);
      });
      const blob=await zip.generateAsync({type:"blob"});
      const a=document.createElement("a"); a.href=URL.createObjectURL(blob);
      a.download="—Å–∂–∞—Ç—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.zip"; a.click();
    };
    function dataURItoBlob(dataURI){
      const byteString=atob(dataURI.split(",")[1]);
      const ab=new ArrayBuffer(byteString.length), ia=new Uint8Array(ab);
      for(let i=0;i<byteString.length;i++) ia[i]=byteString.charCodeAt(i);
      return new Blob([ab],{type:"image/jpeg"});
    }
  </script>
</body>
</html>
