<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Pages íŒŒì¼ ê²€ì‚¬ ë„êµ¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .input-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group textarea {
            height: 120px;
            resize: vertical;
            font-family: 'Courier New', monospace;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-copy {
            background: linear-gradient(135deg, #fd7e14 0%, #e83e8c 100%);
            font-size: 14px;
            padding: 8px 16px;
        }
        
        .results-section {
            margin-top: 30px;
        }
        
        .result-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .result-header {
            padding: 20px;
            font-weight: 600;
            font-size: 1.2em;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .result-header.success {
            background: #d4edda;
            color: #155724;
            border-left: 5px solid #28a745;
        }
        
        .result-header.warning {
            background: #fff3cd;
            color: #856404;
            border-left: 5px solid #ffc107;
        }
        
        .result-header.error {
            background: #f8d7da;
            color: #721c24;
            border-left: 5px solid #dc3545;
        }
        
        .result-content {
            padding: 20px;
        }
        
        .file-list {
            list-style: none;
            padding: 0;
        }
        
        .file-item {
            padding: 12px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .file-item.error {
            border-left-color: #dc3545;
            background: #fff5f5;
        }
        
        .file-item.warning {
            border-left-color: #ffc107;
            background: #fffbf0;
        }
        
        .file-item.missing {
            border-left-color: #6c757d;
            background: #f8f9fa;
        }
        
        .file-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-valid {
            background: #d4edda;
            color: #155724;
        }
        
        .status-invalid {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-missing {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-not-found {
            background: #e2e3e5;
            color: #6c757d;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .code-preview {
            background: #f8f8f8;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .error-details {
            background: #fff5f5;
            border: 1px solid #f5c6cb;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .line-error {
            color: #dc3545;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-top: 4px solid #667eea;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-weight: 500;
        }
        
        .sitemap-tree {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        
        .sitemap-level {
            margin-left: 20px;
            border-left: 2px solid #ddd;
            padding-left: 15px;
            margin-top: 10px;
        }
        
        .sitemap-file {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        .copy-section {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .copy-textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
            margin-bottom: 10px;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” GitHub Pages íŒŒì¼ ê²€ì‚¬ ë„êµ¬</h1>
            <p>ì•ˆì „í•œ HTML ê²€ì‚¬, ì¤‘ì²© ì‚¬ì´íŠ¸ë§µ ë¶„ì„, ìŠ¤ë§ˆíŠ¸ ì†ŒìŠ¤ì½”ë“œ ê²€ìƒ‰</p>
        </div>
        
        <div class="main-content">
            <div class="input-section">
                <h2>ğŸ› ï¸ ê²€ì‚¬ ì„¤ì •</h2>
                <div class="form-group">
                    <label for="repoUrl">GitHub Pages URL (ì˜ˆ: emfls.github.io)</label>
                    <input type="text" id="repoUrl" placeholder="emfls.github.io" value="emfls.github.io">
                </div>
                
                <div class="form-group">
                    <label for="searchCode">ê²€ìƒ‰í•  ì†ŒìŠ¤ì½”ë“œ (ì„ íƒì‚¬í•­)</label>
                    <textarea id="searchCode" placeholder="ê²€ìƒ‰í•˜ê³  ì‹¶ì€ HTML, CSS, JavaScript ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                </div>
                
                <button class="btn" onclick="startAnalysis()">ğŸš€ ë¶„ì„ ì‹œì‘</button>
                <button class="btn" onclick="clearResults()">ğŸ—‘ï¸ ê²°ê³¼ ì´ˆê¸°í™”</button>
            </div>
            
            <div id="loadingSection" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p id="loadingText">íŒŒì¼ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>
            
            <div id="resultsSection" class="results-section" style="display: none;">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalFiles">0</div>
                        <div class="stat-label">ì´ íŒŒì¼ ìˆ˜</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="htmlFiles">0</div>
                        <div class="stat-label">HTML íŒŒì¼</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="sitemapFiles">0</div>
                        <div class="stat-label">ì‚¬ì´íŠ¸ë§µ íŒŒì¼</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="validFiles">0</div>
                        <div class="stat-label">ìœ íš¨í•œ íŒŒì¼</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="errorFiles">0</div>
                        <div class="stat-label">ì˜¤ë¥˜ íŒŒì¼</div>
                    </div>
                </div>
                
                <div id="sitemapResults"></div>
                <div id="htmlValidationResults"></div>
                <div id="codeSearchResults"></div>
            </div>
        </div>
    </div>
    
    <div id="toast" class="toast"></div>

    <script>
        var allFiles = [];
        var allSitemapUrls = [];
        var sitemapStructure = {};
        var analysisResults = {
            totalFiles: 0,
            htmlFiles: 0,
            sitemapFiles: 0,
            validFiles: 0,
            errorFiles: 0,
            missingFromSitemap: [],
            htmlErrors: [],
            codeMatches: [],
            codeNotFound: [],
            sitemapErrors: [],
            allFileUrls: []
        };

        function startAnalysis() {
            var repoUrl = document.getElementById('repoUrl').value.trim();
            var searchCode = document.getElementById('searchCode').value.trim();
            
            if (!repoUrl) {
                alert('GitHub Pages URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            showLoading();
            clearPreviousResults();
            
            var repoInfo = extractRepoInfo(repoUrl);
            if (!repoInfo) {
                alert('ì˜¬ë°”ë¥¸ GitHub Pages URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                hideLoading();
                return;
            }
            
            updateProgress(10, 'ì €ì¥ì†Œ ì •ë³´ í™•ì¸ ì¤‘...');
            
            // ë¹„ë™ê¸° ì‘ì—…ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰
            fetchAllSitemaps(repoUrl)
                .then(function() {
                    updateProgress(40, 'íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ëŠ” ì¤‘...');
                    return fetchAllFiles(repoInfo.owner, repoInfo.repo);
                })
                .then(function() {
                    updateProgress(60, 'HTML íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬ ì¤‘...');
                    return validateHtmlFiles(repoUrl);
                })
                .then(function() {
                    if (searchCode) {
                        updateProgress(80, 'ì†ŒìŠ¤ì½”ë“œ ê²€ìƒ‰ ì¤‘...');
                        return searchInFiles(repoUrl, searchCode);
                    }
                    return Promise.resolve();
                })
                .then(function() {
                    updateProgress(90, 'ì‚¬ì´íŠ¸ë§µ ë¹„êµ ë¶„ì„ ì¤‘...');
                    compareSitemapWithFiles(repoUrl);
                    updateProgress(100, 'ë¶„ì„ ì™„ë£Œ!');
                    setTimeout(function() {
                        displayResults();
                    }, 500);
                })
                .catch(function(error) {
                    console.error('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                    hideLoading();
                    alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                });
        }

        function updateProgress(percentage, text) {
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('loadingText').textContent = text;
        }

        function extractRepoInfo(url) {
            var cleanUrl = url.replace(/^https?:\/\//, '').replace(/\/$/, '');
            var parts = cleanUrl.split('.');
            
            if (parts.length >= 3 && parts[1] === 'github' && parts[2] === 'io') {
                var owner = parts[0];
                var repo = cleanUrl.includes('/') ? cleanUrl.split('/')[1] : owner + '.github.io';
                return { owner: owner, repo: repo };
            }
            
            return null;
        }

        function fetchAllSitemaps(baseUrl) {
            return new Promise(function(resolve, reject) {
                var processedSitemaps = [];
                var sitemapQueue = ['https://' + baseUrl + '/sitemap.xml'];
                
                sitemapStructure = {
                    main: {
                        url: 'https://' + baseUrl + '/sitemap.xml',
                        urls: [],
                        childSitemaps: [],
                        error: null
                    }
                };
                
                function processNextSitemap() {
                    if (sitemapQueue.length === 0) {
                        analysisResults.sitemapFiles = processedSitemaps.length;
                        resolve();
                        return;
                    }
                    
                    var currentSitemapUrl = sitemapQueue.shift();
                    
                    // ì´ë¯¸ ì²˜ë¦¬ëœ ì‚¬ì´íŠ¸ë§µì¸ì§€ í™•ì¸
                    var alreadyProcessed = false;
                    for (var i = 0; i < processedSitemaps.length; i++) {
                        if (processedSitemaps[i] === currentSitemapUrl) {
                            alreadyProcessed = true;
                            break;
                        }
                    }
                    
                    if (alreadyProcessed) {
                        processNextSitemap();
                        return;
                    }
                    
                    processedSitemaps.push(currentSitemapUrl);
                    
                    fetch(currentSitemapUrl)
                        .then(function(response) {
                            if (response.ok) {
                                return response.text();
                            } else {
                                throw new Error('HTTP ' + response.status + ': ' + response.statusText);
                            }
                        })
                        .then(function(xmlText) {
                            var parser = new DOMParser();
                            var xmlDoc = parser.parseFromString(xmlText, 'text/xml');
                            
                            var parseError = xmlDoc.querySelector('parsererror');
                            if (parseError) {
                                throw new Error('XML íŒŒì‹± ì˜¤ë¥˜: ' + parseError.textContent);
                            }
                            
                            var sitemapElements = xmlDoc.getElementsByTagName('sitemap');
                            if (sitemapElements.length > 0) {
                                var childSitemaps = [];
                                for (var i = 0; i < sitemapElements.length; i++) {
                                    var loc = sitemapElements[i].getElementsByTagName('loc')[0];
                                    if (loc) {
                                        childSitemaps.push(loc.textContent);
                                    }
                                }
                                
                                if (currentSitemapUrl === 'https://' + baseUrl + '/sitemap.xml') {
                                    sitemapStructure.main.childSitemaps = childSitemaps;
                                }
                                
                                for (var j = 0; j < childSitemaps.length; j++) {
                                    var childUrl = childSitemaps[j];
                                    var alreadyQueued = false;
                                    for (var k = 0; k < processedSitemaps.length; k++) {
                                        if (processedSitemaps[k] === childUrl) {
                                            alreadyQueued = true;
                                            break;
                                        }
                                    }
                                    if (!alreadyQueued) {
                                        sitemapQueue.push(childUrl);
                                        var sitemapName = childUrl.split('/').pop().replace('.xml', '');
                                        sitemapStructure[sitemapName] = {
                                            url: childUrl,
                                            urls: [],
                                            childSitemaps: [],
                                            error: null
                                        };
                                    }
                                }
                            }
                            
                            var urlElements = xmlDoc.getElementsByTagName('url');
                            var urls = [];
                            for (var i = 0; i < urlElements.length; i++) {
                                var loc = urlElements[i].getElementsByTagName('loc')[0];
                                if (loc) {
                                    urls.push(loc.textContent);
                                }
                            }
                            
                            if (currentSitemapUrl === 'https://' + baseUrl + '/sitemap.xml') {
                                sitemapStructure.main.urls = urls;
                            } else {
                                var sitemapName = currentSitemapUrl.split('/').pop().replace('.xml', '');
                                if (sitemapStructure[sitemapName]) {
                                    sitemapStructure[sitemapName].urls = urls;
                                }
                            }
                            
                            allSitemapUrls = allSitemapUrls.concat(urls);
                            
                            processNextSitemap();
                        })
                        .catch(function(error) {
                            var errorMsg = error.message;
                            if (currentSitemapUrl === 'https://' + baseUrl + '/sitemap.xml') {
                                sitemapStructure.main.error = errorMsg;
                            } else {
                                var sitemapName = currentSitemapUrl.split('/').pop().replace('.xml', '');
                                if (sitemapStructure[sitemapName]) {
                                    sitemapStructure[sitemapName].error = errorMsg;
                                }
                            }
                            analysisResults.sitemapErrors.push({
                                file: currentSitemapUrl,
                                error: errorMsg
                            });
                            
                            processNextSitemap();
                        });
                }
                
                processNextSitemap();
            });
        }

        function fetchAllFiles(owner, repo) {
            return new Promise(function(resolve, reject) {
                fetch('https://api.github.com/repos/' + owner + '/' + repo + '/git/trees/main?recursive=1')
                    .then(function(response) {
                        if (!response.ok) {
                            return fetch('https://api.github.com/repos/' + owner + '/' + repo + '/git/trees/master?recursive=1');
                        }
                        return response;
                    })
                    .then(function(response) {
                        if (!response.ok) {
                            throw new Error('ì €ì¥ì†Œì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        }
                        return response.json();
                    })
                    .then(function(data) {
                        allFiles = [];
                        for (var i = 0; i < data.tree.length; i++) {
                            if (data.tree[i].type === 'blob') {
                                allFiles.push(data.tree[i]);
                            }
                        }
                        
                        analysisResults.totalFiles = allFiles.length;
                        var htmlCount = 0;
                        for (var i = 0; i < allFiles.length; i++) {
                            var path = allFiles[i].path;
                            if (path.endsWith('.html') || path.endsWith('.htm')) {
                                htmlCount++;
                            }
                        }
                        analysisResults.htmlFiles = htmlCount;
                        
                        resolve();
                    })
                    .catch(function(error) {
                        reject(new Error('íŒŒì¼ ëª©ë¡ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message));
                    });
            });
        }

        function validateHtmlFiles(baseUrl) {
            return new Promise(function(resolve, reject) {
                var htmlFiles = [];
                for (var i = 0; i < allFiles.length; i++) {
                    var path = allFiles[i].path;
                    if (path.endsWith('.html') || path.endsWith('.htm')) {
                        htmlFiles.push(allFiles[i]);
                    }
                }
                
                var currentIndex = 0;
                
                function processNextFile() {
                    if (currentIndex >= htmlFiles.length) {
                        resolve();
                        return;
                    }
                    
                    var file = htmlFiles[currentIndex];
                    var progress = 60 + (currentIndex / htmlFiles.length) * 20;
                    updateProgress(progress, 'HTML ê²€ì‚¬ ì¤‘... (' + (currentIndex + 1) + '/' + htmlFiles.length + ')');
                    
                    var fileUrl = 'https://' + baseUrl + '/' + file.path;
                    analysisResults.allFileUrls.push(fileUrl);
                    
                    fetch(fileUrl)
                        .then(function(response) {
                            if (response.ok) {
                                return response.text();
                            } else {
                                throw new Error('íŒŒì¼ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                            }
                        })
                        .then(function(htmlContent) {
                            var errors = validateHtmlContent(htmlContent, file.path);
                            
                            if (errors.length > 0) {
                                analysisResults.htmlErrors.push({
                                    file: file.path,
                                    url: fileUrl,
                                    errors: errors
                                });
                                analysisResults.errorFiles++;
                            } else {
                                analysisResults.validFiles++;
                            }
                            
                            currentIndex++;
                            setTimeout(processNextFile, 50);
                        })
                        .catch(function(error) {
                            analysisResults.htmlErrors.push({
                                file: file.path,
                                url: fileUrl,
                                errors: [{
                                    line: 0,
                                    message: 'íŒŒì¼ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message
                                }]
                            });
                            analysisResults.errorFiles++;
                            
                            currentIndex++;
                            setTimeout(processNextFile, 50);
                        });
                }
                
                processNextFile();
            });
        }

        function validateHtmlContent(html, filePath) {
            var errors = [];
            var lines = html.split('\n');
            
            // ê¸°ë³¸ ê²€ì‚¬ë§Œ ìˆ˜í–‰ (ë³µì¡í•œ íŒŒì‹± ì œê±°)
            if (html.indexOf('<!DOCTYPE') === -1) {
                errors.push({
                    line: 1,
                    message: 'DOCTYPE ì„ ì–¸ì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.'
                });
            }
            
            if (html.indexOf('<html') === -1) {
                errors.push({
                    line: findLineNumber(lines, '<html'),
                    message: 'html íƒœê·¸ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.'
                });
            }
            
            if (html.indexOf('<head>') === -1) {
                errors.push({
                    line: findLineNumber(lines, '<head>'),
                    message: 'head íƒœê·¸ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.'
                });
            }
            
            if (html.indexOf('<body>') === -1) {
                errors.push({
                    line: findLineNumber(lines, '<body>'),
                    message: 'body íƒœê·¸ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.'
                });
            }
            
            return errors;
        }

        function findLineNumber(lines, searchText) {
            for (var i = 0; i < lines.length; i++) {
                if (lines[i].indexOf(searchText) > -1) {
                    return i + 1;
                }
            }
            return 0;
        }

        function searchInFiles(baseUrl, searchCode) {
            return new Promise(function(resolve, reject) {
                var searchableFiles = [];
                for (var i = 0; i < allFiles.length; i++) {
                    var path = allFiles[i].path;
                    if (path.endsWith('.html') || path.endsWith('.css') || 
                        path.endsWith('.js') || path.endsWith('.htm')) {
                        searchableFiles.push(allFiles[i]);
                    }
                }
                
                var normalizedSearchCode = searchCode.replace(/\s+/g, ' ').trim();
                var currentIndex = 0;
                
                function processNextFile() {
                    if (currentIndex >= searchableFiles.length) {
                        resolve();
                        return;
                    }
                    
                    var file = searchableFiles[currentIndex];
                    var progress = 80 + (currentIndex / searchableFiles.length) * 10;
                    updateProgress(progress, 'ì½”ë“œ ê²€ìƒ‰ ì¤‘... (' + (currentIndex + 1) + '/' + searchableFiles.length + ')');
                    
                    var fileUrl = 'https://' + baseUrl + '/' + file.path;
                    
                    fetch(fileUrl)
                        .then(function(response) {
                            if (response.ok) {
                                return response.text();
                            } else {
                                throw new Error('íŒŒì¼ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                            }
                        })
                        .then(function(content) {
                            var normalizedContent = content.replace(/\s+/g, ' ');
                            
                            if (normalizedContent.indexOf(normalizedSearchCode) > -1) {
                                var lines = content.split('\n');
                                var matchingLines = [];
                                
                                for (var i = 0; i < lines.length; i++) {
                                    var normalizedLine = lines[i].replace(/\s+/g, ' ');
                                    if (normalizedLine.indexOf(normalizedSearchCode) > -1) {
                                        matchingLines.push({
                                            lineNumber: i + 1,
                                            content: lines[i].trim()
                                        });
                                    }
                                }
                                
                                analysisResults.codeMatches.push({
                                    file: file.path,
                                    url: fileUrl,
                                    matches: matchingLines
                                });
                            } else {
                                analysisResults.codeNotFound.push({
                                    file: file.path,
                                    url: fileUrl
                                });
                            }
                            
                            currentIndex++;
                            setTimeout(processNextFile, 30);
                        })
                        .catch(function(error) {
                            analysisResults.codeNotFound.push({
                                file: file.path,
                                url: fileUrl,
                                error: error.message
                            });
                            
                            currentIndex++;
                            setTimeout(processNextFile, 30);
                        });
                }
                
                processNextFile();
            });
        }

        function compareSitemapWithFiles(baseUrl) {
            var htmlFiles = [];
            for (var i = 0; i < allFiles.length; i++) {
                var path = allFiles[i].path;
                if (path.endsWith('.html') || path.endsWith('.htm')) {
                    htmlFiles.push(allFiles[i]);
                }
            }
            
            for (var i = 0; i < htmlFiles.length; i++) {
                var file = htmlFiles[i];
                var isMatched = isInSitemap(file.path, allSitemapUrls, baseUrl);
                
                if (!isMatched) {
                    analysisResults.missingFromSitemap.push({
                        file: file.path,
                        expectedUrl: 'https://' + baseUrl + '/' + file.path
                    });
                }
            }
        }

        function isInSitemap(filePath, sitemapUrls, baseUrl) {
            var expectedUrl = 'https://' + baseUrl + '/' + filePath;
            
            // ì •í™•í•œ ë§¤ì¹­ í™•ì¸
            for (var i = 0; i < sitemapUrls.length; i++) {
                if (sitemapUrls[i] === expectedUrl) {
                    return true;
                }
            }
            
            // index.html íŒŒì¼ì˜ í´ë” ë§¤ì¹­ í™•ì¸
            if (filePath.length > 10 && filePath.substring(filePath.length - 10) === 'index.html') {
                var folderPath = filePath.substring(0, filePath.length - 10);
                var folderUrl1 = 'https://' + baseUrl + '/' + folderPath;
                var folderUrl2 = folderUrl1 + '/';
                
                for (var i = 0; i < sitemapUrls.length; i++) {
                    if (sitemapUrls[i] === folderUrl1 || sitemapUrls[i] === folderUrl2) {
                        return true;
                    }
                }
                
                if (folderPath === '') {
                    var rootUrl = 'https://' + baseUrl + '/';
                    for (var i = 0; i < sitemapUrls.length; i++) {
                        if (sitemapUrls[i] === rootUrl) {
                            return true;
                        }
                    }
                }
            }
            
            return false;
        }

        function displayResults() {
            hideLoading();
            document.getElementById('resultsSection').style.display = 'block';
            
            document.getElementById('totalFiles').textContent = analysisResults.totalFiles;
            document.getElementById('htmlFiles').textContent = analysisResults.htmlFiles;
            document.getElementById('sitemapFiles').textContent = analysisResults.sitemapFiles;
            document.getElementById('validFiles').textContent = analysisResults.validFiles;
            document.getElementById('errorFiles').textContent = analysisResults.errorFiles;
            
            displaySitemapResults();
            displayHtmlValidationResults();
            displayCodeSearchResults();
        }

        function displaySitemapResults() {
            var container = document.getElementById('sitemapResults');
            var missing = analysisResults.missingFromSitemap;
            var sitemapErrors = analysisResults.sitemapErrors;
            
            var headerClass = (missing.length > 0 || sitemapErrors.length > 0) ? 'warning' : 'success';
            var headerText = '';
            
            if (sitemapErrors.length > 0) {
                headerText = 'âŒ ì‚¬ì´íŠ¸ë§µ ë¶„ì„ (' + sitemapErrors.length + 'ê°œ ì‚¬ì´íŠ¸ë§µ ì˜¤ë¥˜, ' + missing.length + 'ê°œ íŒŒì¼ ëˆ„ë½)';
                headerClass = 'error';
            } else if (missing.length > 0) {
                headerText = 'âš ï¸ ì‚¬ì´íŠ¸ë§µ ë¶„ì„ (' + missing.length + 'ê°œ íŒŒì¼ì´ ì‚¬ì´íŠ¸ë§µì— ëˆ„ë½ë¨)';
            } else {
                headerText = 'âœ… ì‚¬ì´íŠ¸ë§µ ë¶„ì„ (ëª¨ë“  HTML íŒŒì¼ì´ ì‚¬ì´íŠ¸ë§µì— ë“±ë¡ë¨)';
            }
            
            var content = '<h3>ğŸ“‹ ì‚¬ì´íŠ¸ë§µ êµ¬ì¡°</h3>';
            content += '<div class="sitemap-tree">';
            content += generateSitemapTree();
            content += '</div>';
            
            if (missing.length > 0) {
                content += '<h3>âš ï¸ ì‚¬ì´íŠ¸ë§µì— ëˆ„ë½ëœ íŒŒì¼</h3>';
                content += '<ul class="file-list">';
                for (var i = 0; i < missing.length; i++) {
                    var item = missing[i];
                    content += '<li class="file-item warning">';
                    content += '<span>' + item.file + '</span>';
                    content += '<span class="file-status status-missing">ì‚¬ì´íŠ¸ë§µ ëˆ„ë½</span>';
                    content += '</li>';
                }
                content += '</ul>';
            }
            
            if (sitemapErrors.length === 0 && missing.length === 0) {
                content += '<p>ëª¨ë“  HTML íŒŒì¼ì´ ì‚¬ì´íŠ¸ë§µì— ì ì ˆíˆ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>';
            }
            
            container.innerHTML = '<div class="result-card">' +
                '<div class="result-header ' + headerClass + '">' +
                '<span>' + headerText + '</span>' +
                '</div>' +
                '<div class="result-content">' + content + '</div>' +
                '</div>';
        }

        function generateSitemapTree() {
            var tree = '';
            var mainSitemap = sitemapStructure.main;
            tree += '<div class="sitemap-file">ğŸ“„ sitemap.xml</div>';
            
            if (mainSitemap.error) {
                tree += '<div style="color: #dc3545; margin-left: 20px;">âŒ ' + mainSitemap.error + '</div>';
            } else {
                if (mainSitemap.urls.length > 0) {
                    tree += '<div style="margin-left: 20px; color: #28a745;">âœ… ' + mainSitemap.urls.length + 'ê°œ URL í¬í•¨</div>';
                }
                
                if (mainSitemap.childSitemaps.length > 0) {
                    tree += '<div style="margin-left: 20px; color: #667eea;">ğŸ”— ' + mainSitemap.childSitemaps.length + 'ê°œ í•˜ìœ„ ì‚¬ì´íŠ¸ë§µ ì°¸ì¡°</div>';
                }
            }
            
            return tree;
        }

        function displayHtmlValidationResults() {
            var container = document.getElementById('htmlValidationResults');
            var errors = analysisResults.htmlErrors;
            
            var headerClass = errors.length > 0 ? 'error' : 'success';
            var headerText = errors.length > 0 ? 
                'âŒ HTML ìœ íš¨ì„± ê²€ì‚¬ (' + errors.length + 'ê°œ íŒŒì¼ì—ì„œ ì˜¤ë¥˜ ë°œê²¬)' : 
                'âœ… HTML ìœ íš¨ì„± ê²€ì‚¬ (ëª¨ë“  íŒŒì¼ì´ ìœ íš¨í•¨)';
            
            var content = '';
            if (errors.length > 0) {
                content = '<ul class="file-list">';
                for (var i = 0; i < errors.length; i++) {
                    var item = errors[i];
                    content += '<li class="file-item error">';
                    content += '<div style="width: 100%;">';
                    content += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                    content += '<span><strong>' + item.file + '</strong></span>';
                    content += '<span class="file-status status-invalid">' + item.errors.length + 'ê°œ ì˜¤ë¥˜</span>';
                    content += '</div>';
                    content += '<div class="error-details">';
                    for (var j = 0; j < item.errors.length; j++) {
                        var error = item.errors[j];
                        content += '<div class="line-error">ë¼ì¸ ' + error.line + ': ' + error.message + '</div>';
                    }
                    content += '</div>';
                    content += '</div>';
                    content += '</li>';
                }
                content += '</ul>';
            } else {
                content = '<p>ëª¨ë“  HTML íŒŒì¼ì´ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í†µê³¼í–ˆìŠµë‹ˆë‹¤.</p>';
            }
            
            container.innerHTML = '<div class="result-card">' +
                '<div class="result-header ' + headerClass + '">' +
                '<span>' + headerText + '</span>' +
                '</div>' +
                '<div class="result-content">' + content + '</div>' +
                '</div>';
        }

        function displayCodeSearchResults() {
            var container = document.getElementById('codeSearchResults');
            var matches = analysisResults.codeMatches;
            var notFound = analysisResults.codeNotFound;
            var searchCode = document.getElementById('searchCode').value.trim();
            
            if (!searchCode) {
                container.innerHTML = '';
                return;
            }
            
            var headerClass = matches.length > 0 ? 'success' : 'warning';
            var headerText = 'ğŸ” ì½”ë“œ ê²€ìƒ‰ ê²°ê³¼ (' + matches.length + 'ê°œ íŒŒì¼ì—ì„œ ë°œê²¬, ' + notFound.length + 'ê°œ íŒŒì¼ì—ì„œ ë¯¸ë°œê²¬)';
            
            var content = '';
            
            if (matches.length > 0) {
                content += '<h3>âœ… ì½”ë“œê°€ ë°œê²¬ëœ íŒŒì¼ë“¤</h3>';
                content += '<ul class="file-list">';
                for (var i = 0; i < matches.length; i++) {
                    var item = matches[i];
                    content += '<li class="file-item">';
                    content += '<div style="width: 100%;">';
                    content += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                    content += '<span><strong>' + item.file + '</strong></span>';
                    content += '<span class="file-status status-valid">' + item.matches.length + 'ê°œ ì¼ì¹˜</span>';
                    content += '</div>';
                    content += '</div>';
                    content += '</li>';
                }
                content += '</ul>';
            }
            
            if (notFound.length > 0) {
                content += '<h3>âŒ ì½”ë“œê°€ ë°œê²¬ë˜ì§€ ì•Šì€ íŒŒì¼ë“¤</h3>';
                content += '<ul class="file-list">';
                for (var i = 0; i < notFound.length; i++) {
                    var item = notFound[i];
                    content += '<li class="file-item missing">';
                    content += '<div style="width: 100%;">';
                    content += '<div style="display: flex; justify-content: space-between; align-items: center;">';
                    content += '<span><strong>' + item.file + '</strong></span>';
                    content += '<span class="file-status status-not-found">ì½”ë“œ ì—†ìŒ</span>';
                    content += '</div>';
                    content += '</div>';
                    content += '</li>';
                }
                content += '</ul>';
            }
            
            container.innerHTML = '<div class="result-card">' +
                '<div class="result-header ' + headerClass + '">' +
                '<span>' + headerText + '</span>' +
                '</div>' +
                '<div class="result-content">' + content + '</div>' +
                '</div>';
        }

        function showLoading() {
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
        }

        function hideLoading() {
            document.getElementById('loadingSection').style.display = 'none';
        }

        function clearResults() {
            document.getElementById('resultsSection').style.display = 'none';
            clearPreviousResults();
        }

        function clearPreviousResults() {
            allFiles = [];
            allSitemapUrls = [];
            sitemapStructure = {};
            analysisResults = {
                totalFiles: 0,
                htmlFiles: 0,
                sitemapFiles: 0,
                validFiles: 0,
                errorFiles: 0,
                missingFromSitemap: [],
                htmlErrors: [],
                codeMatches: [],
                codeNotFound: [],
                sitemapErrors: [],
                allFileUrls: []
            };
        }
    </script>
</body>
</html>
