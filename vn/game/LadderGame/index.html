<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Tr√≤ Ch∆°i Thang Leo</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet" />
    <meta
      name="description"
      content="Ch∆°i tr√≤ Thang Leo tr√™n di ƒë·ªông ‚Äì ch·ªçn s·ªë v√† xem v·∫≠n m·ªánh c·ªßa b·∫°n! Tr√≤ ch∆°i web d·ª±a tr√™n may r·ªßi, t·ªëi ∆∞u cho iPhone SE v√† m·ªçi smartphone, nhanh v√† th√∫ v·ªã." />
    <meta
      name="keywords"
      content="tr√≤ ch∆°i thang leo, di ƒë·ªông, webgame, leo thang, tr√≤ ch∆°i may r·ªßi, minigame, gi·∫£i tr√≠ di ƒë·ªông, iPhone SE, tr√≤ ch∆°i thang, random, tr√¨nh duy·ªát, HTML5, ch·ªçn s·ªë, x√£ h·ªôi" />
    <meta name="author" content="Itagi" />
    <meta name="robots" content="index, follow" />

    <link rel="canonical" href="https://emfls.github.io/vn/game/LadderGame" />
    <meta property="og:title" content="Tr√≤ Ch∆°i Thang Leo ‚Äì Tr√≤ ch∆°i di ƒë·ªông may r·ªßi" />
    <meta
      property="og:description"
      content="Ch·ªçn m·ªôt con s·ªë v√† kh√°m ph√° v·∫≠n m·ªánh! Tr√≤ Ch∆°i Thang Leo nhanh, th√∫ v·ªã, ƒë∆∞·ª£c t·ªëi ∆∞u cho di ƒë·ªông." />
    <meta property="og:image" content="https://emfls.github.io/thumbnail.png" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://emfls.github.io/vn/game/LadderGame" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Tr√≤ Ch∆°i Thang Leo ‚Äì Tr√≤ ch∆°i di ƒë·ªông may r·ªßi" />
    <meta name="twitter:description" content="Th√™m ph·∫ßn th√∫ v·ªã: ch·ªçn s·ªë v√† xem v·∫≠n m·ªánh c·ªßa b·∫°n ngay tr√™n di ƒë·ªông!" />
    <meta name="twitter:image" content="https://emfls.github.io/thumbnail.png" />

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QP5Q67GE5B"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-QP5Q67GE5B");
    </script>
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8830524482034754"
      crossorigin="anonymous"></script>

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        min-height: 100vh;
        background: linear-gradient(120deg, #85f, #6cf, #fff 70%);
        font-family: "Jua", "Segoe UI", Arial, sans-serif;
        user-select: none;
        color: #232323;
        box-sizing: border-box;
        width: 100vw;
        overflow-x: hidden;
      }
      #gameWrap {
        width: 100vw;
        max-width: 320px;
        min-width: 220px;
        margin: 0 auto;
        margin-top: 3vw;
        background: #fff8;
        border-radius: 22px;
        box-shadow: 0 8px 32px #2465a344;
        padding: 3vw 2vw 1.3vw 2vw;
        min-height: 670px;
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow: hidden;
      }
      h1 {
        font-size: 2rem;
        letter-spacing: 1px;
        margin-bottom: 0.4em;
        background: linear-gradient(90deg, #7f53ac, #657ced, #43e7fe);
        color: transparent;
        background-clip: text;
        -webkit-background-clip: text;
        font-weight: bold;
      }
      .desc {
        color: #3777b8;
        font-size: 1.05rem;
        text-align: center;
        margin-bottom: 8px;
        margin-top: 2px;
        letter-spacing: 0.01em;
      }
      .btn {
        font-family: inherit;
        font-size: 1.02rem;
        padding: 9px 16px;
        border: none;
        border-radius: 16px;
        margin: 6px;
        box-shadow: 0 2px 8px #85f3;
        cursor: pointer;
        background: linear-gradient(90deg, #7f53ac, #43e7fe);
        color: #fff;
        font-weight: 700;
        transition: 0.15s;
      }
      .btn:active {
        transform: scale(0.96);
      }
      #ladderBox {
        position: relative;
        margin: 10px 0 10px 0;
        width: 100%;
        max-width: 240px;
        min-width: 140px;
        height: 340px;
        background: #e8f2fe;
        border-radius: 14px;
        box-shadow: 0 3px 12px #2579ab1a;
        overflow: hidden;
        display: flex;
        align-items: flex-start;
        justify-content: center;
      }
      canvas {
        display: block;
        width: 100%;
        height: 340px;
      }
      #topChoices {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 20;
        display: flex;
        justify-content: space-between;
        pointer-events: none;
        height: 46px;
      }
      #topChoices button.numBtn {
        pointer-events: all;
        background: linear-gradient(90deg, #fff, #cce7ff);
        border: 2px solid #4786e9;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        font-size: 1.08rem;
        margin: 0;
        color: #2561b2;
        font-weight: bold;
        box-shadow: 0 2px 8px #90cdfa99;
        cursor: pointer;
        transition: 0.12s;
        outline: none;
        position: absolute;
        top: 4px;
        left: 0;
        transform: translateX(-50%);
      }
      #resultMsg {
        min-height: 30px;
        font-size: 1.09rem;
        margin-bottom: 5px;
        color: #437fea;
        font-weight: bold;
        text-align: center;
        letter-spacing: 1px;
      }
      #btnRow {
        margin-top: 6px;
        margin-bottom: 6px;
        width: 100%;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 5px;
      }
      .hide {
        display: none !important;
      }
      @media (max-width: 340px) {
        #gameWrap {
          max-width: 98vw;
          min-width: 170px;
        }
        #ladderBox {
          max-width: 94vw;
          min-width: 110px;
        }
        canvas {
          height: 56vw !important;
        }
        #topChoices button.numBtn {
          width: 27px;
          height: 27px;
          font-size: 0.93rem;
        }
      }
    </style>
  </head>
  <body>
    <div id="gameWrap">
      <h1>Tr√≤ Ch∆°i Thang Leo</h1>
      <div class="desc">Ch·ªçn m·ªôt s·ªë v√† kh√°m ph√° v·∫≠n m·ªánh c·ªßa b·∫°n!</div>
      <div id="ladderBox">
        <div id="topChoices"></div>
        <canvas id="ladderCanvas" width="200" height="340"></canvas>
        <canvas
          id="ladderMask"
          width="200"
          height="340"
          style="
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            display: none;
            pointer-events: none;
          "></canvas>
      </div>
      <div id="resultMsg"></div>
      <div id="btnRow">
        <button class="btn" id="startBtn">B·∫Øt ƒë·∫ßu</button>
        <button class="btn hide" id="retryBtn">Ch∆°i l·∫°i</button>
        <button class="btn" id="shareBtn">Chia s·∫ª</button>
        <button class="btn" id="otherBtn">C√°c tr√≤ ch∆°i kh√°c</button>
      </div>
    </div>
    <script>
      const ladderCols = 4;
      let wave = 1;
      let ladder, playing, busy, result, showTimeout;
      const canvas = document.getElementById("ladderCanvas");
      const ctx = canvas.getContext("2d");
      const maskCanvas = document.getElementById("ladderMask");
      const maskCtx = maskCanvas.getContext("2d");
      const topChoices = document.getElementById("topChoices");
      const resultMsg = document.getElementById("resultMsg");
      const startBtn = document.getElementById("startBtn");
      const retryBtn = document.getElementById("retryBtn");
      const shareBtn = document.getElementById("shareBtn");
      const otherBtn = document.getElementById("otherBtn");

      // T√≠nh v·ªã tr√≠ X d·ª±a tr√™n c·ªôt (ƒëi·ªÅu ch·ªânh padding)
      function getX(idx) {
        const sidePadding = 18; // Padding v·ª´a v·ªõi k√≠ch th∆∞·ªõc nh·ªè h∆°n
        return sidePadding + idx * ((canvas.width - sidePadding * 2) / (ladderCols - 1));
      }

      function getWaveConfig(wave) {
        const minGameOver = Math.min(3, Math.floor((wave - 1) / 3));
        const gameOver = Math.min(ladderCols, 1 + minGameOver);
        const levelUp = ladderCols - gameOver;
        const hLines = Math.min(10, 3 + Math.floor(wave * 1.1));
        return { levelUp, gameOver, hLines };
      }

      function genLadder(wave) {
        const cfg = getWaveConfig(wave);
        let arr = Array(cfg.levelUp).fill("LEVELUP").concat(Array(cfg.gameOver).fill("GAMEOVER"));
        arr = arr.sort(() => Math.random() - 0.5);
        let lines = [];
        const topMargin = 38;
        const bottomMargin = 56; // ƒë·ªÉ kh√¥ng ch·ªìng l√™n k·∫øt qu·∫£
        for (let i = 0; i < cfg.hLines; ++i) {
          let pos, y;
          do {
            pos = Math.floor(Math.random() * (ladderCols - 1));
            y = Math.round(topMargin + (i * (canvas.height - topMargin - bottomMargin)) / (cfg.hLines - 1));
          } while (lines.length && Math.abs(lines[lines.length - 1].pos - pos) < 1);
          lines.push({ y, pos });
        }
        return { lines, ends: arr, cfg };
      }

      function drawLadder(ladder, showEnds = true, highlightPath = null) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#e8f2fe";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        for (let i = 0; i < ladderCols; i++) {
          ctx.beginPath();
          ctx.strokeStyle = "#3272ed";
          ctx.lineWidth = 3.2;
          ctx.moveTo(getX(i), 32);
          ctx.lineTo(getX(i), canvas.height - 42);
          ctx.stroke();
        }
        for (let l of ladder.lines) {
          const x = getX(l.pos);
          ctx.beginPath();
          ctx.strokeStyle = "#f3a922";
          ctx.lineWidth = 5.1;
          ctx.moveTo(x, l.y);
          ctx.lineTo(x + (canvas.width - 36) / (ladderCols - 1), l.y);
          ctx.stroke();
        }
        if (highlightPath) {
          ctx.save();
          ctx.strokeStyle = "#6afc91";
          ctx.lineWidth = 8;
          ctx.shadowColor = "#6afc91cc";
          ctx.shadowBlur = 11;
          ctx.beginPath();
          let { path } = highlightPath;
          ctx.moveTo(path[0].x, path[0].y);
          for (let pt of path) ctx.lineTo(pt.x, pt.y);
          ctx.stroke();
          ctx.restore();
        }
        if (showEnds) {
          for (let i = 0; i < ladderCols; i++) {
            ctx.beginPath();
            ctx.arc(getX(i), canvas.height - 30, 16, 0, 2 * Math.PI);
            ctx.fillStyle = ladder.ends[i] === "LEVELUP" ? "#b2ffd6" : "#ffb6b6";
            ctx.shadowColor = ladder.ends[i] === "LEVELUP" ? "#6afc9170" : "#e97e7e70";
            ctx.shadowBlur = 2;
            ctx.fill();
            ctx.shadowBlur = 0;
            ctx.fillStyle = ladder.ends[i] === "LEVELUP" ? "#10b369" : "#b91414";
            ctx.font = "bold 1.05rem Jua,sans-serif";
            ctx.textAlign = "center";
            ctx.fillText(ladder.ends[i] === "LEVELUP" ? "Lv‚Üë" : "X", getX(i), canvas.height - 24);
          }
        }
      }

      function renderTopChoices() {
        topChoices.innerHTML = "";
        if (!playing || busy) return;
        for (let i = 0; i < ladderCols; i++) {
          let btn = document.createElement("button");
          btn.className = "numBtn";
          btn.innerText = i + 1;
          btn.style.left = `${(getX(i) / canvas.width) * 100}%`;
          btn.onclick = () => chooseStart(i);
          topChoices.appendChild(btn);
        }
      }

      function showMask(show) {
        maskCtx.clearRect(0, 0, maskCanvas.width, maskCanvas.height);
        maskCanvas.style.display = show ? "block" : "none";
        if (show) {
          maskCtx.globalAlpha = 1.0;
          maskCtx.fillStyle = "#e8f2fe";
          maskCtx.fillRect(0, 32, maskCanvas.width, maskCanvas.height - 68);
        }
      }

      function startWave() {
        playing = true;
        busy = false;
        ladder = genLadder(wave);
        resultMsg.innerText = "";
        drawLadder(ladder, true);
        showMask(false);
        renderTopChoices();
        showTimeout && clearTimeout(showTimeout);
        showTimeout = setTimeout(() => {
          showMask(true);
        }, 2200);
      }

      function chooseStart(idx) {
        if (!playing || busy) return;
        busy = true;
        showMask(true);
        const path = calcPath(idx, ladder);
        let t = 0,
          animLen = path.length;
        function animatePath() {
          if (t < animLen) {
            drawLadder(ladder, true, { path: path.slice(0, t + 1) });
            showMask(true);
            t++;
            requestAnimationFrame(animatePath);
          } else {
            drawLadder(ladder, true, { path: path });
            showMask(false);
            setTimeout(() => {
              let endIdx = path[path.length - 1].col;
              let endRes = ladder.ends[endIdx];
              resultMsg.innerHTML = endRes === "LEVELUP"
                ? "üéâ <b>ThƒÉng c·∫•p!</b> Chuy·ªÉn sang v√≤ng ti·∫øp theo ‚Üí"
                : "üíÄ <b>Game Over!</b>";
              renderTopChoices();
              playing = endRes === "LEVELUP";
              busy = false;
              if (endRes === "LEVELUP") {
                wave++;
                setTimeout(startWave, 1000);
              } else {
                retryBtn.classList.remove("hide");
                startBtn.classList.add("hide");
              }
            }, 420);
          }
        }
        animatePath();
      }

      function calcPath(startIdx, ladder) {
        let path = [{ x: getX(startIdx), y: 32, col: startIdx }];
        let col = startIdx;
        for (let l of ladder.lines) {
          path.push({ x: getX(col), y: l.y, col });
          if (col < ladderCols - 1 && l.pos === col) {
            col++;
            path.push({ x: getX(col), y: l.y, col });
          } else if (col > 0 && l.pos === col - 1) {
            col--;
            path.push({ x: getX(col), y: l.y, col });
          }
        }
        path.push({ x: getX(col), y: canvas.height - 42, col });
        return path;
      }

      startBtn.onclick = function () {
        wave = 1;
        retryBtn.classList.add("hide");
        startBtn.classList.add("hide");
        startWave();
      };
      retryBtn.onclick = function () {
        wave = 1;
        retryBtn.classList.add("hide");
        startBtn.classList.add("hide");
        startWave();
      };
      shareBtn.onclick = function () {
        const shareUrl = window.location.href;
        if (navigator.share) {
          navigator.share({ title: document.title, url: shareUrl });
        } else {
          window.prompt("Sao ch√©p URL n√†y ƒë·ªÉ chia s·∫ª:", shareUrl);
        }
      };
      otherBtn.onclick = function () {
        // [2025-06-01] Nh·ªõ √°p d·ª•ng kon/game/ nh∆∞ ƒë√£ n√≥i tr∆∞·ªõc ƒë√≥.
        window.location.href = "kor/game/";
      };

      function resetUI() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        maskCtx.clearRect(0, 0, maskCanvas.width, maskCanvas.height);
        showMask(false);
        resultMsg.innerText = "";
        topChoices.innerHTML = "";
        startBtn.classList.remove("hide");
        retryBtn.classList.add("hide");
      }
      resetUI();

      function resizeAll() {
        const ladderBox = document.getElementById("ladderBox");
        let w = ladderBox.clientWidth;
        canvas.width = w;
        canvas.height = ladderBox.clientHeight;
        maskCanvas.width = w;
        maskCanvas.height = ladderBox.clientHeight;
        if (ladder) {
          drawLadder(ladder, true);
          renderTopChoices();
          showMask(maskCanvas.style.display === "block");
        }
      }
      window.addEventListener("resize", resizeAll);
      setTimeout(resizeAll, 100);
    </script>
    <section
      style="
        width: 80%;
        max-width: 420px;
        margin: 60px auto;
        padding: 20px;
        font-family: &quot;Segoe UI&quot;, sans-serif;
        background: #f0f8ff;
        color: #2d3436;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        line-height: 1.6;
        font-size: 14px;
      ">
      <h2 style="font-size: 20px; margin-bottom: 1rem; color: #1e70c2">‚ùì C√¢u h·ªèi th∆∞·ªùng g·∫∑p (FAQ)</h2>

      <div style="margin-bottom: 1rem">
        <strong>Q1. L√†m th·∫ø n√†o ƒë·ªÉ ch∆°i tr√≤ Thang Leo?</strong><br />
        A. Ch·∫°m s·ªë ·ªü tr√™n c√πng, sau ƒë√≥ ƒëi theo ƒë∆∞·ªùng thang ƒë·ªÉ xem k·∫øt qu·∫£!
      </div>

      <div style="margin-bottom: 1rem">
        <strong>Q2. "ThƒÉng c·∫•p" nghƒ©a l√† g√¨?</strong><br />
        A. B·∫°n v∆∞·ª£t qua v√≤ng n√†y v√† chuy·ªÉn sang v√≤ng kh√≥ h∆°n.
      </div>

      <div style="margin-bottom: 1rem">
        <strong>Q3. Khi n√†o tr√≤ ch∆°i k·∫øt th√∫c?</strong><br />
        A. N·∫øu k·∫øt qu·∫£ l√† <strong>Game Over (X)</strong>, tr√≤ ch∆°i s·∫Ω k·∫øt th√∫c.
      </div>

      <div style="margin-bottom: 1rem">
        <strong>Q4. M·ªçi th·ª© c√≥ ng·∫´u nhi√™n kh√¥ng?</strong><br />
        A. ƒê√∫ng v·∫≠y! C√°c thanh ngang v√† k·∫øt qu·∫£ ƒë∆∞·ª£c l√†m m·ªõi ng·∫´u nhi√™n m·ªói v√≤ng.
      </div>

      <div style="margin-bottom: 1rem">
        <strong>Q5. L√†m sao ƒë·ªÉ ch∆°i l·∫°i?</strong><br />
        A. Ch·∫°m <strong>Ch∆°i l·∫°i</strong> ƒë·ªÉ b·∫Øt ƒë·∫ßu l·∫°i t·ª´ v√≤ng 1.
      </div>

      <div style="margin-bottom: 1rem">
        <strong>Q6. T√¥i c√≥ th·ªÉ chia s·∫ª tr√≤ ch∆°i kh√¥ng?</strong><br />
        A. C√≥! Nh·∫•n <strong>Chia s·∫ª</strong> ƒë·ªÉ sao ch√©p li√™n k·∫øt ho·∫∑c s·ª≠ d·ª•ng t√≠nh nƒÉng chia s·∫ª di ƒë·ªông.
      </div>
    </section>
  </body>
</html>
